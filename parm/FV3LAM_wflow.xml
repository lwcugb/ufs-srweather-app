{#

This is a Jinja-enabled Rocoto XML template. It is filled in using the
fill_template.py script, and is done automatically by the
generate_workflow.sh step of preparing a regional workflow configured
experiment.

See README.xml_templating.md for information on using the Templating mechanisms.
-#}
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE workflow [

<!--
Parameters needed by the job scheduler.
-->
<!ENTITY ACCOUNT       "{{ account }}">
<!ENTITY SCHED         "{{ sched }}">
<!ENTITY QUEUE_DEFAULT "{{ queue_default }}">
<!ENTITY QUEUE_HPSS    "{{ queue_hpss }}">
<!ENTITY QUEUE_FCST    "{{ queue_fcst }}">

<!--
Workflow task names.
-->
{%- if sched_native_cmd  %}
<!ENTITY SCHED_NATIVE_CMD          "{{ sched_native_cmd }}">
{%- else %}
<!ENTITY SCHED_NATIVE_CMD          "">
{%- endif %}
<!ENTITY MAKE_GRID_TN              "{{ make_grid_tn }}">
<!ENTITY MAKE_OROG_TN              "{{ make_orog_tn }}">
<!ENTITY MAKE_SFC_CLIMO_TN         "{{ make_sfc_climo_tn }}">
<!ENTITY GET_EXTRN_ICS_TN          "{{ get_extrn_ics_tn }}">
<!ENTITY GET_EXTRN_LBCS_TN         "{{ get_extrn_lbcs_tn }}">
<!ENTITY MAKE_ICS_TN               "{{ make_ics_tn }}">
<!ENTITY MAKE_LBCS_TN              "{{ make_lbcs_tn }}">
<!ENTITY RUN_FCST_TN               "{{ run_fcst_tn }}">
<!ENTITY RUN_POST_TN               "{{ run_post_tn }}">
<!ENTITY GET_OBS                   "{{ get_obs }}">
{%- if run_task_get_obs_ccpa %}
<!ENTITY GET_OBS_CCPA_TN           "{{ get_obs_ccpa_tn }}">
{%- endif %}
{%- if run_task_get_obs_ndas %}
<!ENTITY GET_OBS_NDAS_TN           "{{ get_obs_ndas_tn }}">
{%- endif %}
{%- if run_task_get_obs_mrms %}
<!ENTITY GET_OBS_MRMS_TN           "{{ get_obs_mrms_tn }}">
{%- endif %}
<!ENTITY VX_TN                     "{{ vx_tn }}">
{%- if run_task_vx_gridstat %}
<!ENTITY VX_GRIDSTAT_TN            "{{ vx_gridstat_tn }}">
<!ENTITY VX_GRIDSTAT_REFC_TN       "{{ vx_gridstat_refc_tn }}">
<!ENTITY VX_GRIDSTAT_RETOP_TN      "{{ vx_gridstat_retop_tn }}">
<!ENTITY VX_GRIDSTAT_03h_TN        "{{ vx_gridstat_03h_tn }}">
<!ENTITY VX_GRIDSTAT_06h_TN        "{{ vx_gridstat_06h_tn }}">
<!ENTITY VX_GRIDSTAT_24h_TN        "{{ vx_gridstat_24h_tn }}">
{%- endif %}
{%- if run_task_vx_pointstat %}
<!ENTITY VX_POINTSTAT_TN           "{{ vx_pointstat_tn }}">
{%- endif %}
{%- if run_task_vx_ensgrid %}
<!ENTITY VX_ENSGRID_TN             "{{ vx_ensgrid_tn }}">
<!ENTITY VX_ENSGRID_REFC_TN        "{{ vx_ensgrid_refc_tn }}">
<!ENTITY VX_ENSGRID_RETOP_TN       "{{ vx_ensgrid_retop_tn }}">
<!ENTITY VX_ENSGRID_03h_TN         "{{ vx_ensgrid_03h_tn }}">
<!ENTITY VX_ENSGRID_06h_TN         "{{ vx_ensgrid_06h_tn }}">
<!ENTITY VX_ENSGRID_24h_TN         "{{ vx_ensgrid_24h_tn }}">
<!ENTITY VX_ENSGRID_MEAN_TN        "{{ vx_ensgrid_mean_tn }}">
<!ENTITY VX_ENSGRID_PROB_TN        "{{ vx_ensgrid_prob_tn }}">
<!ENTITY VX_ENSGRID_MEAN_03h_TN    "{{ vx_ensgrid_mean_03h_tn }}">
<!ENTITY VX_ENSGRID_PROB_03h_TN    "{{ vx_ensgrid_prob_03h_tn }}">
<!ENTITY VX_ENSGRID_MEAN_06h_TN    "{{ vx_ensgrid_mean_06h_tn }}">
<!ENTITY VX_ENSGRID_PROB_06h_TN    "{{ vx_ensgrid_prob_06h_tn }}">
<!ENTITY VX_ENSGRID_MEAN_24h_TN    "{{ vx_ensgrid_mean_24h_tn }}">
<!ENTITY VX_ENSGRID_PROB_24h_TN    "{{ vx_ensgrid_prob_24h_tn }}">
<!ENTITY VX_ENSGRID_PROB_REFC_TN   "{{ vx_ensgrid_prob_refc_tn }}">
<!ENTITY VX_ENSGRID_PROB_RETOP_TN  "{{ vx_ensgrid_prob_retop_tn }}">
{%- endif %}
{%- if run_task_vx_enspoint %}
<!ENTITY VX_ENSPOINT_TN            "{{ vx_enspoint_tn }}">
<!ENTITY VX_ENSPOINT_MEAN_TN       "{{ vx_enspoint_mean_tn }}">
<!ENTITY VX_ENSPOINT_PROB_TN       "{{ vx_enspoint_prob_tn }}">
{%- endif %}
{%- if run_task_plot_allvars %}
<!ENTITY PLOT_ALLVARS_TN           "{{ plot_allvars_tn }}">
{%- endif %}
{%- if run_task_aqm_ics %}
<!ENTITY AQM_EXTRN_ICS_TN          "{{ aqm_ics_tn }}_ext">
<!ENTITY AQM_ICS_TN                "{{ aqm_ics_tn }}">
{%- endif %}
{%- if run_task_aqm_lbcs %}
<!ENTITY AQM_LBCS_TN               "{{ aqm_lbcs_tn }}">
{%- endif %}
{%- if run_task_nexus_gfs_sfc %}
<!ENTITY NEXUS_GFS_SFC_TN         "{{ nexus_gfs_sfc_tn }}">
{%- endif %}
{%- if run_task_nexus_emission %}
<!ENTITY NEXUS_EMISSION_TN         "{{ nexus_emission_tn }}">
<!ENTITY NEXUS_POST_SPLIT_TN       "{{ nexus_post_split_tn }}">
{%- endif %}
{%- if run_task_fire_emission %}
<!ENTITY FIRE_EMISSION_TN          "{{ fire_emission_tn }}">
{%- endif %}
{%- if run_task_point_source %}
<!ENTITY POINT_SOURCE_TN           "{{ point_source_tn }}">
{%- endif %}
{%- if run_task_pre_post_stat %}
<!ENTITY PRE_POST_STAT_TN          "{{ pre_post_stat_tn }}">
{%- endif %}
{%- if run_task_post_stat_o3 %}
<!ENTITY POST_STAT_O3_TN           "{{ post_stat_o3_tn }}">
{%- endif %}
{%- if run_task_post_stat_pm25 %}
<!ENTITY POST_STAT_PM25_TN         "{{ post_stat_pm25_tn }}">
{%- endif %}
{%- if run_task_bias_correction_o3 %}
<!ENTITY BIAS_CORRECTION_O3_TN     "{{ bias_correction_o3_tn }}">
{%- endif %}
{%- if run_task_bias_correction_pm25 %}
<!ENTITY BIAS_CORRECTION_PM25_TN   "{{ bias_correction_pm25_tn }}">
{%- endif %}

<!--
Flags that specify whether to run the preprocessing and/or verification tasks.
-->
<!ENTITY RUN_TASK_MAKE_GRID      "{{ run_task_make_grid | upper }}">
<!ENTITY RUN_TASK_MAKE_OROG      "{{ run_task_make_orog | upper }}">
<!ENTITY RUN_TASK_MAKE_SFC_CLIMO "{{ run_task_make_sfc_climo | upper }}">

<!--
Number of physical cores per node for the current machine.  This is used
below in the <nodesize> tag, but that tag is not clearly documented.  This
parameter may be unnecessary since each task now has its own variable that
specifies the number of processes per node being used (the PPN_... entities).
-->
<!ENTITY NCORES_PER_NODE "{{ ncores_per_node }}">

<!--
Directories and files.
-->
<!ENTITY USHdir                   "{{ ushdir }}">
<!ENTITY JOBSdir                  "{{ jobsdir }}">
<!ENTITY SCRIPTSdir               "{{ scriptsdir }}">
<!ENTITY COMIN_BASEDIR            "{{ comin_basedir }}">
<!ENTITY COMOUT_BASEDIR           "{{ comout_basedir }}">
<!ENTITY GLOBAL_VAR_DEFNS_FP      "{{ global_var_defns_fp }}">
<!ENTITY LOAD_MODULES_RUN_TASK_FP "{{ load_modules_run_task_fp }}">
<!ENTITY EXPTDIR                  "{{ exptdir }}">


{%- if run_envir == "nco"  %}
{%- if do_ensemble %}
<!ENTITY DYN_DIR  "{{ dataroot }}/run_fcst_{{ ensmem_indx_name }}#{{ ensmem_indx_name }}#.{{ workflow_id }}_<cyclestr>@Y@m@d@H</cyclestr>/dyn">
<!ENTITY PHY_DIR  "{{ dataroot }}/run_fcst_{{ ensmem_indx_name }}#{{ ensmem_indx_name }}#.{{ workflow_id }}_<cyclestr>@Y@m@d@H</cyclestr>/phy">
<!ENTITY COMIN_DIR "{{ comin_basedir }}/{{ run }}.@Y@m@d/@H">
{%- else %}
<!ENTITY DYN_DIR  "{{ dataroot }}/run_fcst.{{ workflow_id }}_<cyclestr>@Y@m@d@H</cyclestr>/dyn">
<!ENTITY PHY_DIR  "{{ dataroot }}/run_fcst.{{ workflow_id }}_<cyclestr>@Y@m@d@H</cyclestr>/phy">
<!ENTITY COMIN_DIR "{{ comin_basedir }}/{{ run }}.@Y@m@d/@H">
{%- endif %}
{%- else %}
<!ENTITY DYN_DIR  "{{ comout_basedir }}/<cyclestr>@Y@m@d@H</cyclestr>{{ slash_ensmem_subdir }}/dyn">
<!ENTITY PHY_DIR  "{{ comout_basedir }}/<cyclestr>@Y@m@d@H</cyclestr>{{ slash_ensmem_subdir }}/phy">
<!ENTITY COMIN_DIR "{{ comin_basedir }}/@Y@m@d@H{{ slash_ensmem_subdir }}">
{%- endif %}

{%- if run_envir == "nco"  %}
<!ENTITY LOGDIR                   "{{ logbasedir }}/<cyclestr>@Y@m@d</cyclestr>">
<!ENTITY LOGEXT                   ".{{ workflow_id }}.log" >
{%- else %}
<!ENTITY LOGDIR                   "{{ logbasedir }}">
<!ENTITY LOGEXT                   ".log" >
{%- endif %}
<!ENTITY CMPEXT                   "_task_complete.txt">

<!ENTITY MET_INSTALL_DIR "{{ met_install_dir }}">
<!ENTITY METPLUS_PATH "{{ metplus_path }}">
<!ENTITY METPLUS_CONF "{{ metplus_conf }}">
<!ENTITY MET_CONFIG "{{ met_config }}">
<!ENTITY CCPA_OBS_DIR "{{ ccpa_obs_dir }}">
<!ENTITY MRMS_OBS_DIR "{{ mrms_obs_dir }}">
<!ENTITY NDAS_OBS_DIR "{{ ndas_obs_dir }}">

<!ENTITY WARMSTART_CYCLE_DIR  "{{ warmstart_cycle_dir }}">
{%- if do_real_time %}
<!ENTITY COMINgfs_BASEDIR         "{{ comingfs_basedir }}">
{%- endif %}

<!--
Reservation types.  Reservations specify the queue/partition and account
to use for a given task.  The "DEFAULT" reservation type is used for all 
tasks other than GET_EXTRN_ICS_TN, GET_EXTRN_LBCS_TN, and RUN_FCST_TN; 
the "HPSS" type is used for the GET_EXTRN_ICS_TN and GET_EXTRN_LBCS_TN 
tasks; and the "FCST" type is used for the RUN_FCST_TN task.
-->

{%- if partition_default is not none %}
<!ENTITY RSRV_DEFAULT "<account>&ACCOUNT;</account><queue>&QUEUE_DEFAULT;</queue><partition>{{ partition_default }}</partition>">
{%- else %}
<!ENTITY RSRV_DEFAULT "<account>&ACCOUNT;</account><queue>&QUEUE_DEFAULT;</queue>">
{%- endif %}
{%- if partition_hpss is not none %}
<!ENTITY RSRV_HPSS    "<account>&ACCOUNT;</account><queue>&QUEUE_HPSS;</queue><partition>{{ partition_hpss }}</partition>">
{%- else %}
<!ENTITY RSRV_HPSS    "<account>&ACCOUNT;</account><queue>&QUEUE_HPSS;</queue>">
{%- endif %}
{%- if partition_fcst is not none %}
<!ENTITY RSRV_FCST    "<account>&ACCOUNT;</account><queue>&QUEUE_FCST;</queue><partition>{{ partition_fcst }}</partition>">
{%- else %}
<!ENTITY RSRV_FCST    "<account>&ACCOUNT;</account><queue>&QUEUE_FCST;</queue>">
{%- endif %}

]>

<workflow realtime="F" scheduler="&SCHED;" cyclethrottle="60" taskthrottle="{{ taskthrottle }}">
{# Double quotes are required inside the strftime! Expect an error from reading the template if using single quotes. #}
  <cycledef group="at_start">{{ cdate_first_cycl.strftime("%M %H %d %m %Y *") }}</cycledef>
  <cycledef group="forecast">
    {{- date_first_cycl ~ " " ~ date_last_cycl ~ " " ~ cycl_freq -}}
  </cycledef>
{%- if cycl_next != date_first_cycl %}
  <cycledef group="cycled">
    {{- cycl_next ~ " " ~ date_last_cycl ~ " " ~ cycl_freq -}}
  </cycledef>
{%- endif %}
  <log>
  {%- if run_envir == "nco"  %}
    &LOGDIR;/FV3LAM_wflow.{{ workflow_id }}.log
  {%- else %}
    &LOGDIR;/FV3LAM_wflow.log
  {%- endif %}
  </log>

<!-- 
The following command works to call the J-job for a given task (in this
case the MAKE_GRID_TN task) if in the script LOAD_MODULES_RUN_TASK_FP we 
do NOT call exec to run the J-job.  The command first sources the script
LOAD_MODULES_RUN_TASK_FP and then runs the J-job, so it is simpler than
calling exec and thus preferred if NCO accepts it.  Note that the portion
of the command that sources LOAD_MODULES_RUN_TASK_FP also passes an 
argument to it (the argument being the name of the task).  This works in
bash but it probably won't work in sh.

If this method is acceptable to NCO, then for clarity maybe we can
source LOAD_MODULES_RUN_TASK_FP within the J-job instead of here since
we are already sourcing other files in the J-job anyway.
-->
<!--
    <command>{ . &LOAD_MODULES_RUN_TASK_FP; "&MAKE_GRID_TN;";
               &JOBSdir;/JREGIONAL_MAKE_GRID;
             }</command>
-->
<!--
The following command works if we call exec in LOAD_MODULES_RUN_TASK_FP
to run the J-job.  This passes the J-job script as the second argument
to LOAD_MODULES_RUN_TASK_FP (the first argument is the task name).  The
J-job then uses exec to run the J-job (while also terminating the LOAD_-
MODULES_RUN_TASK_FP script.
-->

{%- if run_task_make_grid %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&MAKE_GRID_TN;" cycledefs="at_start" maxtries="{{ maxtries_make_grid }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&MAKE_GRID_TN;" "&JOBSdir;/JREGIONAL_MAKE_GRID"</command>
    <nodes>{{ nnodes_make_grid }}:ppn={{ ppn_make_grid }}</nodes>
    <walltime>{{ wtime_make_grid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&MAKE_GRID_TN;</jobname>
    <join>&LOGDIR;/&MAKE_GRID_TN;&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>

  </task>
{%- endif %}
{%- if run_task_make_orog %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&MAKE_OROG_TN;" cycledefs="at_start" maxtries="{{ maxtries_make_orog }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&MAKE_OROG_TN;" "&JOBSdir;/JREGIONAL_MAKE_OROG"</command>
    <nodes>{{ nnodes_make_orog }}:ppn={{ ppn_make_orog }}</nodes>
    <walltime>{{ wtime_make_orog }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&MAKE_OROG_TN;</jobname>
    <join>&LOGDIR;/&MAKE_OROG_TN;&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>

    <dependency>
      <or>
<!--        <taskdep task="make_grid"/> -->
        <datadep age="00:00:00:05">&EXPTDIR;/grid/&MAKE_GRID_TN;&CMPEXT;</datadep>
        <streq><left>&RUN_TASK_MAKE_GRID;</left><right>FALSE</right></streq>
      </or>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_make_sfc_climo %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&MAKE_SFC_CLIMO_TN;" cycledefs="at_start" maxtries="{{ maxtries_make_sfc_climo }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&MAKE_SFC_CLIMO_TN;" "&JOBSdir;/JREGIONAL_MAKE_SFC_CLIMO"</command>
    <nodes>{{ nnodes_make_sfc_climo }}:ppn={{ ppn_make_sfc_climo }}</nodes>
    <walltime>{{ wtime_make_sfc_climo }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&MAKE_SFC_CLIMO_TN;</jobname>
    <join>&LOGDIR;/&MAKE_SFC_CLIMO_TN;&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>

    <dependency>
      <and>
        <or>
<!--          <taskdep task="&MAKE_GRID_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/grid/&MAKE_GRID_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_GRID;</left><right>FALSE</right></streq>
        </or>
        <or>
<!--          <taskdep task="&MAKE_OROG_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/orog/&MAKE_OROG_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_OROG;</left><right>FALSE</right></streq>
        </or>
      </and>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_nexus_gfs_sfc %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&NEXUS_GFS_SFC_TN;" cycledefs="forecast" maxtries="{{ maxtries_nexus_gfs_sfc }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&NEXUS_GFS_SFC_TN;" "&JOBSdir;/JREGIONAL_NEXUS_GFS_SFC"</command>
    <nodes>{{ nnodes_nexus_gfs_sfc }}:ppn={{ ppn_nexus_gfs_sfc }}</nodes>
    <walltime>{{ wtime_nexus_gfs_sfc }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- if machine not in ["WCOSS2"] %}
    <native>&SCHED_NATIVE_CMD;</native>
  {%- endif %}
    <jobname>&NEXUS_GFS_SFC_TN;</jobname>
    <join>&LOGDIR;/&NEXUS_GFS_SFC_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

{%- if do_real_time %}
    <dependency>
      <datadep age="00:00:00:05"><cyclestr offset="-{{- cycl_freq -}}">&COMINgfs_BASEDIR;/gfs.@Y@m@d/@H/atmos</cyclestr></datadep>
    </dependency>
{%- endif %}

</task>
{%- endif %}
{%- if run_task_nexus_emission %}
<!--
************************************************************************
************************************************************************
-->
  <metatask name="&NEXUS_EMISSION_TN;">
    <var name="nspt">{% for h in range(0, num_split_nexus) %}{{ " %02d" % h }}{% endfor %}</var>
      <task name="&NEXUS_EMISSION_TN;_#nspt#" cycledefs="forecast" maxtries="{{ maxtries_nexus_emission }}">
        &RSRV_DEFAULT;
        <command>&LOAD_MODULES_RUN_TASK_FP; "&NEXUS_EMISSION_TN;" "&JOBSdir;/JREGIONAL_NEXUS_EMISSION"</command>
        {%- if machine in ["HERA"]  %}
        <nodes>{{ nnodes_nexus_emission }}:ppn={{ ppn_nexus_emission }}</nodes>
        <native>{{ native_nexus_emission }}</native>
        {%- elif machine in ["WCOSS2"]  %}
        <nodes>{{ nnodes_nexus_emission }}:ppn={{ ppn_nexus_emission }}:tpp={{ omp_num_threads_nexus_emission }}</nodes>
        <native>&SCHED_NATIVE_CMD;</native>
        {%- else %}
        <nodes>{{ nnodes_nexus_emission }}:ppn={{ ppn_nexus_emission }}</nodes>    
        {%- endif %}
        <walltime>{{ wtime_nexus_emission }}</walltime>
        <nodesize>&NCORES_PER_NODE;</nodesize>
        <jobname>&NEXUS_EMISSION_TN;_#nspt#</jobname>
        <join>&LOGDIR;/&NEXUS_EMISSION_TN;<cyclestr>_@Y@m@d@H_s#nspt#&LOGEXT;</cyclestr></join>

        <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
        <envar><name>USHdir</name><value>&USHdir;</value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
        <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
        <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
        <envar><name>nspt</name><value>#nspt#</value></envar>
	<envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
	<envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

{%- if run_task_nexus_gfs_sfc %}	
        <dependency>
          <taskdep task="&NEXUS_GFS_SFC_TN;"/>    
	</dependency>
{%- endif %}
      </task>
  </metatask>      
  <task name="&NEXUS_POST_SPLIT_TN;" cycledefs="forecast" maxtries="{{ maxtries_nexus_post_split }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&NEXUS_POST_SPLIT_TN;" "&JOBSdir;/JREGIONAL_NEXUS_POST_SPLIT"</command>
    <nodes>{{ nnodes_nexus_post_split }}:ppn={{ ppn_nexus_post_split }}</nodes>
    <walltime>{{ wtime_nexus_post_split }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&NEXUS_POST_SPLIT_TN;</jobname>
    <join>&LOGDIR;/&NEXUS_POST_SPLIT_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <metataskdep metatask="&NEXUS_EMISSION_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_fire_emission %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&FIRE_EMISSION_TN;" cycledefs="forecast" maxtries="{{ maxtries_fire_emission }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&FIRE_EMISSION_TN;" "&JOBSdir;/JREGIONAL_FIRE_EMISSION"</command>
    <nodes>{{ nnodes_fire_emission }}:ppn={{ ppn_fire_emission }}</nodes>
    <walltime>{{ wtime_fire_emission }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- if machine not in ["WCOSS2"] %}
    <native>&SCHED_NATIVE_CMD;</native>
  {%- endif %}
    <jobname>&FIRE_EMISSION_TN;</jobname>
    <join>&LOGDIR;/&FIRE_EMISSION_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
  </task>
{%- endif %}
{%- if run_task_point_source %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&POINT_SOURCE_TN;" cycledefs="forecast" maxtries="{{ maxtries_point_source }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&POINT_SOURCE_TN;" "&JOBSdir;/JREGIONAL_POINT_SOURCE"</command>
  {%- if machine in ["WCOSS2"]  %}
    <nodes>{{ nnodes_point_source }}:ppn={{ ppn_point_source }}:tpp={{ omp_num_threads_point_source }}</nodes>
    <native>&SCHED_NATIVE_CMD;</native>
  {%- else %}
    <nodes>{{ nnodes_point_source }}:ppn={{ ppn_point_source }}</nodes>    
  {%- endif %}
    <walltime>{{ wtime_point_source }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&POINT_SOURCE_TN;</jobname>
    <join>&LOGDIR;/&POINT_SOURCE_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
<!-- <taskdep task="&MAKE_GRID_TN;"/> -->
      <or>
        <datadep age="00:00:00:05">&EXPTDIR;/grid/&MAKE_GRID_TN;&CMPEXT;</datadep>
        <streq><left>&RUN_TASK_MAKE_GRID;</left><right>FALSE</right></streq>
      </or>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_get_extrn_ics %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&GET_EXTRN_ICS_TN;" cycledefs="forecast" maxtries="{{ maxtries_get_extrn_ics }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&GET_EXTRN_ICS_TN;" "&JOBSdir;/JREGIONAL_GET_EXTRN_MDL_FILES"</command>
    <nodes>{{ nnodes_get_extrn_ics }}:ppn={{ ppn_get_extrn_ics }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_get_extrn_ics }}</memory>
  {%- endif %}
    <walltime>{{ wtime_get_extrn_ics }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- if machine not in ["WCOSS2"] %}
    <native>&SCHED_NATIVE_CMD;</native>
  {%- endif %}
    <jobname>&GET_EXTRN_ICS_TN;</jobname>
    <join>&LOGDIR;/&GET_EXTRN_ICS_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>ICS_OR_LBCS</name><value>ICS</value></envar>
{%- if do_real_time %}
    <dependency>
      <datadep age="00:00:00:05"><cyclestr offset="-{{- cycl_freq -}}">&COMINgfs_BASEDIR;/gfs.@Y@m@d/@H/atmos</cyclestr></datadep>
    </dependency>
{%- endif %}
  </task>
{%- endif %}
{%- if run_task_get_extrn_lbcs %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&GET_EXTRN_LBCS_TN;" cycledefs="forecast" maxtries="{{ maxtries_get_extrn_lbcs }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&GET_EXTRN_LBCS_TN;" "&JOBSdir;/JREGIONAL_GET_EXTRN_MDL_FILES"</command>
    <nodes>{{ nnodes_get_extrn_lbcs }}:ppn={{ ppn_get_extrn_lbcs }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_get_extrn_lbcs }}</memory>
  {%- endif %}
    <walltime>{{ wtime_get_extrn_lbcs }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize> 
  {%- if machine not in ["WCOSS2"] %}
    <native>&SCHED_NATIVE_CMD;</native>
  {%- endif %}
    <jobname>&GET_EXTRN_LBCS_TN;</jobname>
    <join>&LOGDIR;/&GET_EXTRN_LBCS_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>ICS_OR_LBCS</name><value>LBCS</value></envar>

{%- if do_real_time %}
    <dependency>
      <datadep age="00:00:00:05"><cyclestr offset="-{{- cycl_freq -}}">&COMINgfs_BASEDIR;/gfs.@Y@m@d/@H/atmos</cyclestr></datadep>
    </dependency>
{%- endif %}

  </task>
{%- endif %}
<!--
************************************************************************
************************************************************************
-->
{%- if do_ensemble %}
  <metatask name="run_ensemble">

    <var name="{{ ensmem_indx_name }}">{% for m in range(1, num_ens_members+1) %}{{ "%03d " % m }}{% endfor %}</var>

{%- endif %}

{%- if run_task_make_ics %}
  <task name="&MAKE_ICS_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_make_ics }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&MAKE_ICS_TN;" "&JOBSdir;/JREGIONAL_MAKE_ICS"</command>
    <nodes>{{ nnodes_make_ics }}:ppn={{ ppn_make_ics }}</nodes>
    <walltime>{{ wtime_make_ics }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&MAKE_ICS_TN;{{ uscore_ensmem_name }}</jobname>
    <join>&LOGDIR;/&MAKE_ICS_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

    <dependency>
      <and>
        <taskdep task="&GET_EXTRN_ICS_TN;"/>
        <or>
<!--          <taskdep task="&MAKE_GRID_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/grid/&MAKE_GRID_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_GRID;</left><right>FALSE</right></streq>
        </or>
        <or>
<!--          <taskdep task="&MAKE_OROG_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/orog/&MAKE_OROG_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_OROG;</left><right>FALSE</right></streq>
        </or>
        <or>
<!--          <taskdep task="&MAKE_SFC_CLIMO_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/sfc_climo/&MAKE_SFC_CLIMO_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_SFC_CLIMO;</left><right>FALSE</right></streq>
        </or>
      </and>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_make_lbcs %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&MAKE_LBCS_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_make_lbcs }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&MAKE_LBCS_TN;" "&JOBSdir;/JREGIONAL_MAKE_LBCS"</command>
    <nodes>{{ nnodes_make_lbcs }}:ppn={{ ppn_make_lbcs }}</nodes>
    <walltime>{{ wtime_make_lbcs }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&MAKE_LBCS_TN;{{ uscore_ensmem_name }}</jobname>
    <join>&LOGDIR;/&MAKE_LBCS_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

    <dependency>
      <and>
        <taskdep task="&GET_EXTRN_LBCS_TN;"/>
        <or>
<!--          <taskdep task="&MAKE_GRID_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/grid/&MAKE_GRID_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_GRID;</left><right>FALSE</right></streq>
        </or>
        <or>
<!--          <taskdep task="&MAKE_OROG_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/orog/&MAKE_OROG_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_OROG;</left><right>FALSE</right></streq>
        </or>
        <or>
<!--          <taskdep task="&MAKE_SFC_CLIMO_TN;"/> -->
          <datadep age="00:00:00:05">&EXPTDIR;/sfc_climo/&MAKE_SFC_CLIMO_TN;&CMPEXT;</datadep>
          <streq><left>&RUN_TASK_MAKE_SFC_CLIMO;</left><right>FALSE</right></streq>
        </or>
      </and>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_aqm_ics %}
  {%- if not coldstart %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&AQM_EXTRN_ICS_TN;" cycledefs="at_start" maxtries="{{ maxtries_aqm_ics }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&AQM_ICS_TN;" "&JOBSdir;/JREGIONAL_AQM_ICS"</command>
    <nodes>{{ nnodes_aqm_ics }}:ppn={{ ppn_aqm_ics }}</nodes>
    <walltime>{{ wtime_aqm_ics }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&AQM_EXTRN_ICS_TN;</jobname>
    <join>&LOGDIR;/&AQM_EXTRN_ICS_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>PREV_CYCLE_DIR</name><value>&WARMSTART_CYCLE_DIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <and>
        <taskdep task="&MAKE_ICS_TN;"/>
        <or>
          <datadep age="00:00:00:05">&WARMSTART_CYCLE_DIR;/RESTART/<cyclestr>@Y@m@d.@H@M@S.fv_tracer.res.tile1.nc</cyclestr></datadep>
          <datadep age="00:00:00:05">&WARMSTART_CYCLE_DIR;/RESTART/fv_tracer.res.tile1.nc</datadep>
        </or>
      </and>
    </dependency>

  </task>
  {%- endif %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&AQM_ICS_TN;" cycledefs="cycled" maxtries="{{ maxtries_aqm_ics }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&AQM_ICS_TN;" "&JOBSdir;/JREGIONAL_AQM_ICS"</command>
    <nodes>{{ nnodes_aqm_ics }}:ppn={{ ppn_aqm_ics }}</nodes>
    <walltime>{{ wtime_aqm_ics }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&AQM_ICS_TN;</jobname>
    <join>&LOGDIR;/&AQM_ICS_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>PREV_CYCLE_DIR</name><value><cyclestr offset="-{{- cycl_freq -}}">&COMIN_DIR;</cyclestr></value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <and>
        <taskdep task="&MAKE_ICS_TN;"/>
        <or>
          <datadep age="00:00:00:05"><cyclestr offset="-{{- cycl_freq -}}">&COMIN_DIR;</cyclestr>/RESTART/<cyclestr>@Y@m@d.@H@M@S.fv_tracer.res.tile1.nc</cyclestr></datadep>
          <datadep age="00:00:00:05"><cyclestr offset="-{{- cycl_freq -}}">&COMIN_DIR;</cyclestr>/RESTART/fv_tracer.res.tile1.nc</datadep>
        </or>
      </and>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_aqm_lbcs %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&AQM_LBCS_TN;" cycledefs="forecast" maxtries="{{ maxtries_aqm_lbcs }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&AQM_LBCS_TN;" "&JOBSdir;/JREGIONAL_AQM_LBCS"</command>
    <nodes>{{ nnodes_aqm_lbcs }}:ppn={{ ppn_aqm_lbcs }}</nodes>
    <walltime>{{ wtime_aqm_lbcs }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&AQM_LBCS_TN;</jobname>
    <join>&LOGDIR;/&AQM_LBCS_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
        <taskdep task="&MAKE_LBCS_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_run_fcst %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&RUN_FCST_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_run_fcst }}">

    &RSRV_FCST;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&RUN_FCST_TN;" "&JOBSdir;/JREGIONAL_RUN_FCST"</command>
  {%- if machine in ["JET", "HERA", "LINUX"]  %}
    <cores>{{ ncores_run_fcst }}</cores>
    <native>{{ native_run_fcst }}</native>
  {%- elif machine in ["WCOSS2"]  %}
    <nodes>{{ nnodes_run_fcst }}:ppn={{ ppn_run_fcst }}:tpp={{ omp_num_threads_run_fcst }}</nodes>
    <native>&SCHED_NATIVE_CMD;</native>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- else %}
    <nodes>{{ nnodes_run_fcst }}:ppn={{ ppn_run_fcst }}</nodes>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- endif %}
    <native>&SCHED_NATIVE_CMD;</native>
    <walltime>{{ wtime_run_fcst }}</walltime>
    <jobname>&RUN_FCST_TN;{{ uscore_ensmem_name }}</jobname>
    <join>&LOGDIR;/&RUN_FCST_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

    <dependency>
      <and>
        <taskdep task="&MAKE_ICS_TN;{{ uscore_ensmem_name }}"/>
        <taskdep task="&MAKE_LBCS_TN;{{ uscore_ensmem_name }}"/>
{%- if run_task_nexus_emission %}
        <taskdep task="&NEXUS_POST_SPLIT_TN;"/>
{%- endif %}
{%- if run_task_fire_emission %}
        <taskdep task="&FIRE_EMISSION_TN;"/>
{%- endif %}
{%- if run_task_point_source %}
        <taskdep task="&POINT_SOURCE_TN;"/>
{%- endif %}
{%- if run_task_aqm_ics %}
        <or>
          <taskdep task="&AQM_ICS_TN;"/>
{%- if not coldstart %}
          <and>
            <not><cycleexistdep cycle_offset="-{{- cycl_freq -}}"/></not>
            <taskdep task="&AQM_EXTRN_ICS_TN;"/>
          </and>
{%- else %}
          <not><cycleexistdep cycle_offset="-{{- cycl_freq -}}"/></not>
{%- endif %}
        </or>
{%- endif %}
{%- if run_task_aqm_lbcs %}
        <taskdep task="&AQM_LBCS_TN;"/>
{%- endif %}
      </and>
    </dependency>

  </task>
{%- endif %}
<!--
************************************************************************
************************************************************************
-->
{%- if run_task_run_post %}
  {%- if sub_hourly_post %}
<!--
Define the post-processing task for first model output time.  The forecast 
hour corresponding to this output time is zero (formatted to the appropriate
number of digits), and the corresponding forecast minute is the first model 
time step dt_atmos, i.e. it is not zero.  This is because FV3 is designed 
such that its first output file contains fields at the first time step.  
It is for this reason that this task is not rolled into the metatask(s) 
further below.

Note that we wrap this task in a metatask in order to be able to declare
and use the variables fhr and fmn.  This allows the block of code inside
the <task> tag (except for the dependencies) to be identical to the ones 
later below for other output times.
-->
  <metatask>

    <var name="fhr">000</var>
    <var name="fmn">00</var>
    <task name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#" cycledefs="forecast" maxtries="{{ maxtries_run_post }}">

      &RSRV_DEFAULT;
      <command>&LOAD_MODULES_RUN_TASK_FP; "&RUN_POST_TN;" "&JOBSdir;/JREGIONAL_RUN_POST"</command>
      <nodes>{{ nnodes_run_post }}:ppn={{ ppn_run_post }}</nodes>
      <walltime>{{ wtime_run_post }}</walltime>
      <nodesize>&NCORES_PER_NODE;</nodesize>
      <native>&SCHED_NATIVE_CMD;</native>
      <jobname>&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#</jobname>
      <join>&LOGDIR;/&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

      <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
      <envar><name>USHdir</name><value>&USHdir;</value></envar>
      <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
      <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
      <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
      <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
      <envar><name>fhr</name><value>#fhr#</value></envar>
      <envar><name>fmn</name><value>#fmn#</value></envar>
      <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
      <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

<!--
Note that because the forecast minutes and seconds corresponding to the
first model output time are not exactly zero, we use the jinja template
variable first_fv3_file_tstr instead of fhr and fmn to form the file 
names in the dependencies.
-->
      <dependency>
        <or>
          <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
          <and>
            <datadep age="05:00">&DYN_DIR;f{{ first_fv3_file_tstr }}.nc</datadep>
            <datadep age="05:00">&PHY_DIR;f{{ first_fv3_file_tstr }}.nc</datadep>
          </and>
        </or>
      </dependency>

    </task>

  </metatask>

<!--
Define the post-processing tasks for the second through last output minutes
of the first output hour (which is zero).  We use two metatasks for this.
The inner one is needed to loop over the minutes, and the outer one is
used in order to be able to declare and use the variable fhr.  Use of this
variable (along with the fmn variable in the inner metatask) allows the
block of code inside the <task> tag to be identical to the ones later below
for other output times.
-->
  <metatask name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f000">

    <var name="fhr">000</var>
    <metatask>

      <var name="fmn">{% for min in range(delta_min, 60, delta_min) %}{{ " %02d" % min }}{% endfor %}</var>
      <task name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#" cycledefs="forecast" maxtries="{{ maxtries_run_post }}">

        &RSRV_DEFAULT;
        <command>&LOAD_MODULES_RUN_TASK_FP; "&RUN_POST_TN;" "&JOBSdir;/JREGIONAL_RUN_POST"</command>
        <nodes>{{ nnodes_run_post }}:ppn={{ ppn_run_post }}</nodes>
        <walltime>{{ wtime_run_post }}</walltime>
        <nodesize>&NCORES_PER_NODE;</nodesize>
        <native>&SCHED_NATIVE_CMD;</native>
        <jobname>&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#</jobname>
	<join>&LOGDIR;/&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

        <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
        <envar><name>USHdir</name><value>&USHdir;</value></envar>
        <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
        <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
        <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
        <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
        <envar><name>fhr</name><value>#fhr#</value></envar>
        <envar><name>fmn</name><value>#fmn#</value></envar>
        <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
        <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

        <dependency>
          <or>
            <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
            <and>
              <datadep age="05:00">&DYN_DIR;f#fhr#:#fmn#:00.nc</datadep>
              <datadep age="05:00">&PHY_DIR;f#fhr#:#fmn#:00.nc</datadep>
            </and>
          </or>
        </dependency>

      </task>

    </metatask>

  </metatask>
  {%- endif %}

  <metatask name="&RUN_POST_TN;{{ uscore_ensmem_name }}">
  {%- if sub_hourly_post %}
<!--
Define the post-processing tasks for the second through next-to-last model
output hours (and all output minutes for each such hour).  
-->
    <var name="fhr">{% for h in range(1, fcst_len_hrs) %}{{ " %03d" % h }}{% endfor %}</var>
    <metatask>
      <var name="fmn">{% for min in range(0, 60, delta_min) %}{{ " %02d" % min }}{% endfor %}</var>
      <task name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#" cycledefs="forecast" maxtries="{{ maxtries_run_post }}">
  {%- else %}
<!--
Define the post-processing tasks for each model output hour.  Note that
only one metatask is needed for this purpose (the inner one that loops 
over the hours), but we use two metatasks in order to be able to use the 
variable fmn, which here is always set to zero.  Use of this variable 
(along with the fhr variable in the inner metatask) allows the block of 
code inside the <task> tag to be identical to the case in which subhourly 
post-processing is performed (i.e. the case in which the minutes are not 
always zero).
-->
    <var name="fhr">{% for h in range(0, fcst_len_hrs+1) %}{{ " %03d" % h }}{% endfor %}</var>
      <task name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr#" cycledefs="forecast" maxtries="{{ maxtries_run_post }}">
  {%- endif %}

        &RSRV_DEFAULT;
        <command>&LOAD_MODULES_RUN_TASK_FP; "&RUN_POST_TN;" "&JOBSdir;/JREGIONAL_RUN_POST"</command>
        <nodes>{{ nnodes_run_post }}:ppn={{ ppn_run_post }}</nodes>
        <walltime>{{ wtime_run_post }}</walltime>
        <nodesize>&NCORES_PER_NODE;</nodesize>
        <native>&SCHED_NATIVE_CMD;</native>
        {%- if sub_hourly_post %}
        <jobname>&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#</jobname>
	<join>&LOGDIR;/&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>
        {%- else %}
        <jobname>&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr#</jobname>
	<join>&LOGDIR;/&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr#<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>
        {%- endif %}

        <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
        <envar><name>USHdir</name><value>&USHdir;</value></envar>
        <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
        <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
        <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
        <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
        {%- if sub_hourly_post %}
        <envar><name>fhr</name><value>#fhr#</value></envar>
        <envar><name>fmn</name><value>#fmn#</value></envar>
        {%- else %}
        <envar><name>fhr</name><value>#fhr#</value></envar>
        {%- endif %}
        <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
        <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

        <dependency>
          <or>
            <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
            <and>
            {%- if sub_hourly_post %}
              <datadep age="05:00">&DYN_DIR;f#fhr#:#fmn#:00.nc</datadep>
              <datadep age="05:00">&PHY_DIR;f#fhr#:#fmn#:00.nc</datadep>
            {%- else %}
              <datadep age="05:00">&DYN_DIR;f#fhr#.nc</datadep>
              <datadep age="05:00">&PHY_DIR;f#fhr#.nc</datadep>
            {%- endif %}
            </and>
          </or>
        </dependency>

      </task>

    {%- if sub_hourly_post %}
    </metatask>
    {%- else %}
    {%- endif %}
  </metatask>

  {%- if sub_hourly_post %}
<!--
Define the post-processing task for the last model output time.  The 
forecast hour corresponding to this output time is the length of the 
forecast (assuming it is specified in integer hours), and the corresponding 
minute is 0.  This task cannot be included in the metatask above because 
for a given hour, the latter loops over all the valid output minutes, 
whereas for this last hour, only the first minute must be considered.

Note that we wrap this task in a metatask in order to be able to declare
and use the variables fhr and fmn.  This allows the block of code inside
the <task> tag to be identical to the ones above for other output times.
-->
  <metatask>

    <var name="fhr">{{ "%03d" % fcst_len_hrs }}</var>
    <var name="fmn">00</var>
    <task name="&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#" cycledefs="forecast" maxtries="{{ maxtries_run_post }}">

      &RSRV_DEFAULT;
      <command>&LOAD_MODULES_RUN_TASK_FP; "&RUN_POST_TN;" "&JOBSdir;/JREGIONAL_RUN_POST"</command>
      <nodes>{{ nnodes_run_post }}:ppn={{ ppn_run_post }}</nodes>
      <walltime>{{ wtime_run_post }}</walltime>
      <nodesize>&NCORES_PER_NODE;</nodesize>
      <native>&SCHED_NATIVE_CMD;</native>
      <jobname>&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#</jobname>
      <join>&LOGDIR;/&RUN_POST_TN;{{ uscore_ensmem_name }}_f#fhr##fmn#<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

      <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
      <envar><name>USHdir</name><value>&USHdir;</value></envar>
      <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
      <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
      <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
      <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
      <envar><name>fhr</name><value>#fhr#</value></envar>
      <envar><name>fmn</name><value>#fmn#</value></envar>
      <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
      <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

      <dependency>
        <or>
          <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
          <and>
            <datadep age="05:00">&DYN_DIR;f#fhr#:#fmn#:00.nc</datadep>
            <datadep age="05:00">&PHY_DIR;f#fhr#:#fmn#:00.nc</datadep>
          </and>
        </or>
      </dependency>

    </task>

  </metatask>
  {%- endif %}
{%- endif %}
{%- if run_task_pre_post_stat %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&PRE_POST_STAT_TN;" cycledefs="forecast" maxtries="{{ maxtries_pre_post_stat }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&PRE_POST_STAT_TN;" "&JOBSdir;/JREGIONAL_PRE_POST_STAT"</command>
    <nodes>{{ nnodes_pre_post_stat }}:ppn={{ ppn_pre_post_stat }}</nodes>
    <walltime>{{ wtime_pre_post_stat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&PRE_POST_STAT_TN;</jobname>
    <join>&LOGDIR;/&PRE_POST_STAT_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar> 
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>    
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
{%- if run_task_run_post %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
{%- else %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
{%- endif %}
    </dependency>
  </task>
{%- endif %}
{%- if run_task_plot_allvars %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&PLOT_ALLVARS_TN;" cycledefs="forecast" maxtries="{{ maxtries_plot_allvars }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&PLOT_ALLVARS_TN;" "&JOBSdir;/JREGIONAL_PLOT_ALLVARS"</command>
    <nodes>{{ nnodes_plot_allvars }}:ppn={{ ppn_plot_allvars }}</nodes>
    <walltime>{{ wtime_plot_allvars }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
  {%- if machine not in ["WCOSS2"] %}
    <native>&SCHED_NATIVE_CMD;</native>
  {%- endif %}
    <jobname>&PLOT_ALLVARS_TN;</jobname>
    <join>&LOGDIR;/&PLOT_ALLVARS_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>

    <dependency>
        {%- if write_dopost %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
    </dependency>

  </task>
{%- endif %}
{%- if run_task_post_stat_o3 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&POST_STAT_O3_TN;" cycledefs="forecast" maxtries="{{ maxtries_post_stat_o3 }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&POST_STAT_O3_TN;" "&JOBSdir;/JREGIONAL_POST_STAT_O3"</command>
    <nodes>{{ nnodes_post_stat_o3 }}:ppn={{ ppn_post_stat_o3 }}</nodes>
{%- if machine not in ["GAEA"]  %}
    <memory>{{ mem_post_stat_o3 }}</memory>
{%- endif %}
    <walltime>{{ wtime_post_stat_o3 }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&POST_STAT_O3_TN;</jobname>
    <join>&LOGDIR;/&POST_STAT_O3_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar> 
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>    
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <taskdep task="&PRE_POST_STAT_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_post_stat_pm25 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&POST_STAT_PM25_TN;" cycledefs="forecast" maxtries="{{ maxtries_post_stat_pm25 }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&POST_STAT_PM25_TN;" "&JOBSdir;/JREGIONAL_POST_STAT_PM25"</command>
    <nodes>{{ nnodes_post_stat_pm25 }}:ppn={{ ppn_post_stat_pm25 }}</nodes>
{%- if machine not in ["GAEA"]  %}
    <memory>{{ mem_post_stat_pm25 }}</memory>
{%- endif %}    
    <walltime>{{ wtime_post_stat_pm25 }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&POST_STAT_PM25_TN;</jobname>
    <join>&LOGDIR;/&POST_STAT_PM25_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar> 
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>    
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <taskdep task="&PRE_POST_STAT_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_bias_correction_o3 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&BIAS_CORRECTION_O3_TN;" cycledefs="forecast" maxtries="{{ maxtries_bias_correction_o3 }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&BIAS_CORRECTION_O3_TN;" "&JOBSdir;/JREGIONAL_BIAS_CORRECTION_O3"</command>
    <nodes>{{ nnodes_bias_correction_o3 }}:ppn={{ ppn_bias_correction_o3 }}</nodes>
{%- if machine not in ["GAEA"]  %}
    <memory>{{ mem_bias_correction_o3 }}</memory>
{%- endif %}
    <walltime>{{ wtime_bias_correction_o3 }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&BIAS_CORRECTION_O3_TN;</jobname>
    <join>&LOGDIR;/&BIAS_CORRECTION_O3_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar> 
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>    
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <taskdep task="&PRE_POST_STAT_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_bias_correction_pm25 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&BIAS_CORRECTION_PM25_TN;" cycledefs="forecast" maxtries="{{ maxtries_bias_correction_pm25 }}">
    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&BIAS_CORRECTION_PM25_TN;" "&JOBSdir;/JREGIONAL_BIAS_CORRECTION_PM25"</command>
    <nodes>{{ nnodes_bias_correction_pm25 }}:ppn={{ ppn_bias_correction_pm25 }}</nodes>
{%- if machine not in ["GAEA"]  %}
    <memory>{{ mem_bias_correction_pm25 }}</memory>
{%- endif %}
    <walltime>{{ wtime_bias_correction_pm25 }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <jobname>&BIAS_CORRECTION_PM25_TN;</jobname>
    <join>&LOGDIR;/&BIAS_CORRECTION_PM25_TN;<cyclestr>_@Y@m@d@H&LOGEXT;</cyclestr></join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>    
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar> 
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>    
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>

    <dependency>
      <taskdep task="&PRE_POST_STAT_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if run_task_get_obs_ccpa %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&GET_OBS_CCPA_TN;" cycledefs="forecast" maxtries="{{ maxtries_get_obs_ccpa }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&GET_OBS;" "&JOBSdir;/JREGIONAL_GET_OBS_CCPA"</command>
    <nodes>{{ nnodes_get_obs_ccpa }}:ppn={{ ppn_get_obs_ccpa }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_get_obs_ccpa }}</memory>
  {%- endif %}
    <walltime>{{ wtime_get_obs_ccpa }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&GET_OBS_CCPA_TN;</jobname>
    <join>&LOGDIR;/&GET_OBS_CCPA_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>ACCUM</name><value>01</value></envar>

  </task>
{%- endif %}

{%- if run_task_get_obs_mrms %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&GET_OBS_MRMS_TN;" cycledefs="forecast" maxtries="{{ maxtries_get_obs_mrms }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&GET_OBS;" "&JOBSdir;/JREGIONAL_GET_OBS_MRMS"</command>
    <nodes>{{ nnodes_get_obs_mrms }}:ppn={{ ppn_get_obs_mrms }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_get_obs_mrms }}</memory>
  {%- endif %}
    <walltime>{{ wtime_get_obs_mrms }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&GET_OBS_MRMS_TN;</jobname>
    <join>&LOGDIR;/&GET_OBS_MRMS_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>SCRIPTSdir</name><value>&SCRIPTSdir;</value></envar>
    <envar><name>VAR</name><value>REFC RETOP</value></envar>
 
  </task>
{%- endif %}

{%- if run_task_get_obs_ndas %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&GET_OBS_NDAS_TN;" cycledefs="forecast" maxtries="{{ maxtries_get_obs_ndas }}">

    &RSRV_HPSS;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&GET_OBS;" "&JOBSdir;/JREGIONAL_GET_OBS_NDAS"</command>
    <nodes>{{ nnodes_get_obs_ndas }}:ppn={{ ppn_get_obs_ndas }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_get_obs_ndas }}</memory>
  {%- endif %}
    <walltime>{{ wtime_get_obs_ndas }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&GET_OBS_NDAS_TN;</jobname>
    <join>&LOGDIR;/&GET_OBS_NDAS_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&NDAS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>01</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      {%- if run_task_get_obs_ccpa %}
      <and>
        <taskdep task="&GET_OBS_CCPA_TN;"/>
        {%- if write_dopost %}
        <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
        <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      </and>
      {%- else %}
        {%- if write_dopost %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      {%- endif %}
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_REFC_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat_refc }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_REFC_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_REFC_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>REFC</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      {%- if run_task_get_obs_mrms %}
      <and>
        <taskdep task="&GET_OBS_MRMS_TN;"/>
        {%- if write_dopost %}
        <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
        <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      </and>
      {%- else %}
        {%- if write_dopost %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      {%- endif %}
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_RETOP_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat_retop }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_RETOP_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_RETOP_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>RETOP</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      {%- if run_task_get_obs_mrms %}
      <and>
        <taskdep task="&GET_OBS_MRMS_TN;"/>
        {%- if write_dopost %}
        <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
        <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      </and>
      {%- else %}
        {%- if write_dopost %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      {%- endif %}
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat and fcst_len_hrs >= 3 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_03h_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat_03h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_03h_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_03h_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(3, fcst_len_hrs+1, 3) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>03</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      <taskdep task="&VX_GRIDSTAT_TN;{{ uscore_ensmem_name }}"/>
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat and fcst_len_hrs >= 6 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_06h_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat_06h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_06h_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_06h_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(6, fcst_len_hrs+1, 6) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>06</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      <taskdep task="&VX_GRIDSTAT_TN;{{ uscore_ensmem_name }}"/>
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_gridstat and fcst_len_hrs >= 24 %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_GRIDSTAT_24h_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_gridstat_24h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_GRIDSTAT"</command>
    <nodes>{{ nnodes_vx_gridstat }}:ppn={{ ppn_vx_gridstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_gridstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_gridstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_GRIDSTAT_24h_TN;</jobname>
    <join>&LOGDIR;/&VX_GRIDSTAT_24h_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(24, fcst_len_hrs+1, 24) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>24</value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      <taskdep task="&VX_GRIDSTAT_TN;{{ uscore_ensmem_name }}"/>
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_pointstat %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_POINTSTAT_TN;{{ uscore_ensmem_name }}" cycledefs="forecast" maxtries="{{ maxtries_vx_pointstat }}">
    &RSRV_DEFAULT;

    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_POINTSTAT"</command>
    <nodes>{{ nnodes_vx_pointstat }}:ppn={{ ppn_vx_pointstat }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_pointstat }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_pointstat }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_POINTSTAT_TN;</jobname>
    <join>&LOGDIR;/&VX_POINTSTAT_TN;{{ uscore_ensmem_name }}<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&NDAS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    {%- if do_ensemble %}
    <envar><name>SLASH_ENSMEM_SUBDIR</name><value><cyclestr>{{ slash_ensmem_subdir }}</cyclestr></value></envar>
    <envar><name>ENSMEM_INDX</name><value><cyclestr>#{{ ensmem_indx_name }}#</cyclestr></value></envar>
    {%- endif %}

    <dependency>
      {%- if run_task_get_obs_ndas %}
      <and>
        <taskdep task="&GET_OBS_NDAS_TN;"/>
        {%- if write_dopost %}
        <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
        <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      </and>
      {%- else %}
        {%- if write_dopost %}
      <taskdep task="&RUN_FCST_TN;{{ uscore_ensmem_name }}"/>
        {%- else %}
      <metataskdep metatask="&RUN_POST_TN;{{ uscore_ensmem_name }}"/>
        {%- endif %}
      {%- endif %}
    </dependency>

  </task>
{%- endif %}

{%- if do_ensemble %}
  </metatask>
{%- endif %}

{%- if run_task_vx_ensgrid %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_ENSGRID_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>01</value></envar>

    <dependency>
      <metataskdep metatask="run_ensemble"/>
    </dependency>

  </task>

{%- if fcst_len_hrs >= 3 %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_03h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_03h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_03h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_03h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(3, fcst_len_hrs+1, 3) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>03</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if fcst_len_hrs >= 6 %}   
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_06h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_06h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_06h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_06h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(6, fcst_len_hrs+1, 6) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>06</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if fcst_len_hrs >= 24 %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_24h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_24h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_24h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_24h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(24, fcst_len_hrs+1, 24) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>24</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_TN;"/>
    </dependency>

  </task>
{%- endif %}
<!--
************************************************************************
************************************************************************
-->

<task name="&VX_ENSGRID_REFC_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_refc }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_REFC_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_REFC_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>REFC</value></envar>

    <dependency>
      <metataskdep metatask="run_ensemble"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

<task name="&VX_ENSGRID_RETOP_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_retop }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID"</command>
    <nodes>{{ nnodes_vx_ensgrid }}:ppn={{ ppn_vx_ensgrid }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_RETOP_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_RETOP_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>RETOP</value></envar>

    <dependency>
      <metataskdep metatask="run_ensemble"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_ENSGRID_MEAN_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_mean }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_MEAN"</command>
    <nodes>{{ nnodes_vx_ensgrid_mean }}:ppn={{ ppn_vx_ensgrid_mean }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_mean }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_mean }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_MEAN_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_MEAN_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>01</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>01</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_TN;"/>
    </dependency>

  </task>
{%- if fcst_len_hrs >= 3 %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_MEAN_03h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_mean_03h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_MEAN"</command>
    <nodes>{{ nnodes_vx_ensgrid_mean }}:ppn={{ ppn_vx_ensgrid_mean }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_mean }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_mean }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_MEAN_03h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_MEAN_03h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(3, fcst_len_hrs+1, 3) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>03</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_03h_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_03h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob_03h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_03h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_03h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(3, fcst_len_hrs+1, 3) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>03</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_03h_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if fcst_len_hrs >= 6 %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_MEAN_06h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_mean_06h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_MEAN"</command>
    <nodes>{{ nnodes_vx_ensgrid_mean }}:ppn={{ ppn_vx_ensgrid_mean }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_mean }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_mean }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_MEAN_06h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_MEAN_06h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(6, fcst_len_hrs+1, 6) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>06</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_06h_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_06h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob_06h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_06h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_06h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(6, fcst_len_hrs+1, 6) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>06</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_06h_TN;"/>
    </dependency>

  </task>
{%- endif %}
{%- if fcst_len_hrs >= 24 %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_MEAN_24h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_mean_24h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_MEAN"</command>
    <nodes>{{ nnodes_vx_ensgrid_mean }}:ppn={{ ppn_vx_ensgrid_mean }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_mean }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_mean }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_MEAN_24h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_MEAN_24h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(24, fcst_len_hrs+1, 24) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>24</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_24h_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_24h_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob_24h }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_24h_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_24h_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&CCPA_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(24, fcst_len_hrs+1, 24) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>APCP</value></envar>
    <envar><name>ACCUM</name><value>24</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_24h_TN;"/>
    </dependency>

  </task>
{%- endif %}
<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_REFC_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob_refc }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_REFC_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_REFC_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>REFC</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_REFC_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->

  <task name="&VX_ENSGRID_PROB_RETOP_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_ensgrid_prob_retop }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSGRID_PROB"</command>
    <nodes>{{ nnodes_vx_ensgrid_prob }}:ppn={{ ppn_vx_ensgrid_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_ensgrid_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_ensgrid_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSGRID_PROB_RETOP_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSGRID_PROB_RETOP_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&MRMS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(1, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>
    <envar><name>VAR</name><value>RETOP</value></envar>

    <dependency>
      <taskdep task="&VX_ENSGRID_RETOP_TN;"/>
    </dependency>

  </task>
{%- endif %}

{%- if run_task_vx_enspoint %}
<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_ENSPOINT_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_enspoint }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSPOINT"</command>
    <nodes>{{ nnodes_vx_enspoint }}:ppn={{ ppn_vx_enspoint }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_enspoint }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_enspoint }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSPOINT_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSPOINT_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&NDAS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>

    <dependency>
      <metataskdep metatask="run_ensemble"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_ENSPOINT_MEAN_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_enspoint_mean }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSPOINT_MEAN"</command>
    <nodes>{{ nnodes_vx_enspoint_mean }}:ppn={{ ppn_vx_enspoint_mean }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_enspoint_mean }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_enspoint_mean }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSPOINT_MEAN_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSPOINT_MEAN_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&NDAS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>

    <dependency>
      <taskdep task="&VX_ENSPOINT_TN;"/>
    </dependency>

  </task>

<!--
************************************************************************
************************************************************************
-->
  <task name="&VX_ENSPOINT_PROB_TN;" cycledefs="forecast" maxtries="{{ maxtries_vx_enspoint_prob }}">

    &RSRV_DEFAULT;
    <command>&LOAD_MODULES_RUN_TASK_FP; "&VX_TN;" "&JOBSdir;/JREGIONAL_RUN_VX_ENSPOINT_PROB"</command>
    <nodes>{{ nnodes_vx_enspoint_prob }}:ppn={{ ppn_vx_enspoint_prob }}</nodes>
  {%- if machine not in ["GAEA", "NOAACLOUD"]  %}
    <memory>{{ mem_vx_enspoint_prob }}</memory>
  {%- endif %}
    <walltime>{{ wtime_vx_enspoint_prob }}</walltime>
    <nodesize>&NCORES_PER_NODE;</nodesize>
    <native>&SCHED_NATIVE_CMD;</native>
    <jobname>&VX_ENSPOINT_PROB_TN;</jobname>
    <join>&LOGDIR;/&VX_ENSPOINT_PROB_TN;<cyclestr>_@Y@m@d@H</cyclestr>&LOGEXT;</join>

    <envar><name>GLOBAL_VAR_DEFNS_FP</name><value>&GLOBAL_VAR_DEFNS_FP;</value></envar>
    <envar><name>USHdir</name><value>&USHdir;</value></envar>
    <envar><name>OBS_DIR</name><value>&NDAS_OBS_DIR;</value></envar>
    <envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
    <envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
    <envar><name>subcyc</name><value><cyclestr>@M</cyclestr></value></envar>
    <envar><name>LOGDIR</name><value>&LOGDIR;</value></envar>
    <envar><name>FHR</name><value><cyclestr> {% for h in range(0, fcst_len_hrs+1) %}{{ " %02d" % h  }}{% endfor %} </cyclestr></value></envar>

    <dependency>
      <taskdep task="&VX_ENSPOINT_TN;"/>
    </dependency>

  </task>

{%- endif %}
</workflow>
